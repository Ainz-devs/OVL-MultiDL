<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OVL-MultiDL - Téléchargement</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Inter',sans-serif }
    body {
      background:linear-gradient(to bottom right,#0a0a0a,#141414);
      color:#e6e6e6;
      min-height:100vh;
      overflow-x:hidden;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding-top:70px
    }
    .background-anim {
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      z-index:0;
      overflow:hidden;
      pointer-events:none
    }
    .background-anim span {
      position:absolute;
      width:60px;
      height:60px;
      background:rgba(30,144,255,0.15);
      border-radius:50%;
      animation:float 15s infinite ease-in-out
    }
    @keyframes float {
      0% { transform:translateY(100vh) scale(0.5); opacity:0 }
      50% { opacity:1 }
      100% { transform:translateY(-100vh) scale(1.2); opacity:0 }
    }
    header {
      position:fixed;
      top:0;
      left:0;
      right:0;
      z-index:10;
      display:flex;
      justify-content:space-between;
      align-items:center;
      background:rgba(0,0,0,0.5);
      backdrop-filter:blur(10px);
      padding:15px 20px;
      box-shadow:0 0 15px rgba(0,0,0,0.4)
    }
    .logo-title {
      font-size:1.4rem;
      font-weight:800;
      color:#1e90ff;
      user-select:none
    }
    .home-icon {
      cursor:pointer
    }
    .home-icon svg {
      width:28px;
      height:28px;
      fill:#1e90ff
    }
    main.container {
      max-width:600px;
      width:90%;
      background:rgba(20,20,20,0.7);
      backdrop-filter:blur(15px);
      padding:30px 25px 40px;
      border-radius:25px;
      box-shadow:0 0 30px rgba(30,144,255,0.3);
      text-align:center;
      z-index:5;
      margin-bottom:50px
    }
    main h2 {
      font-size:2rem;
      color:#1e90ff;
      font-weight:800;
      margin-bottom:25px
    }
    .media-wrapper {
      width:100%;
      margin-bottom:25px;
      display:flex;
      justify-content:center;
      align-items:center;
      flex-direction:column
    }
    .media-wrapper video,
    .media-wrapper .audio-container {
      width:100%;
      max-width:100%;
      border-radius:16px;
      background:#111;
      box-shadow:0 0 20px rgba(30,144,255,0.7);
      overflow:hidden
    }
    .audio-container {
      padding:20px;
      display:flex;
      flex-direction:column;
      align-items:center
    }
    .audio-container audio {
      width:100%;
      height:48px;
      background:#000;
      border-radius:10px;
      outline:none
    }
    .media-title {
      font-weight:700;
      font-size:1.5rem;
      margin-bottom:30px;
      word-break:break-word;
      color:#d3d3d3;
      user-select:text
    }
    .btn-download,
    .btn-return {
      display:inline-block;
      padding:14px 40px;
      font-weight:700;
      font-size:1.1rem;
      border-radius:14px;
      cursor:pointer;
      border:none;
      text-decoration:none;
      user-select:none;
      transition:background-color 0.3s ease,transform 0.2s ease;
      margin:10px 15px 0 15px;
      box-shadow:0 0 15px rgba(30,144,255,0.6);
      color:#fff;
      background-color:#1e90ff;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px
    }
    .btn-download:hover,
    .btn-return:hover {
      background-color:#1c86ee;
      transform:scale(1.05)
    }
    .btn-return {
      background-color:transparent;
      color:#1e90ff;
      border:2px solid #1e90ff;
      box-shadow:none;
      margin-top:30px
    }
    .btn-return:hover {
      background-color:#1e90ff;
      color:#fff;
      box-shadow:0 0 20px rgba(30,144,255,0.8)
    }
  </style>
</head>
<body>
  <div class="background-anim">
    <span style="left:10%;animation-delay:0s"></span>
    <span style="left:30%;animation-delay:3s"></span>
    <span style="left:50%;animation-delay:6s"></span>
    <span style="left:70%;animation-delay:1s"></span>
    <span style="left:90%;animation-delay:5s"></span>
  </div>
  <header>
    <div class="logo-title">OVL-MultiDL</div>
    <div class="home-icon" onclick="window.location.href='/'">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M12 3l10 9h-3v9h-5v-6H10v6H5v-9H2z" />
      </svg>
    </div>
  </header>
  <main class="container" id="resultContainer">
    <h2>Résultat</h2>
    <div class="media-wrapper" id="mediaWrapper"></div>
    <div class="media-title" id="mediaTitle">Chargement...</div>
    <a href="#" class="btn-download" id="downloadBtn"><i class="fas fa-download"></i> Télécharger maintenant</a>
    <button class="btn-return" id="btnReturn"><i class="fas fa-undo-alt"></i> Retour</button>
  </main>
  <script>
    function getIdFromPath() {
      const parts = window.location.pathname.split('/');
      return parts.length ? parts[parts.length - 1] : null;
    }
    async function fetchResult(id) {
      try {
        const res = await fetch(`/api/ovldl?id=${encodeURIComponent(id)}`);
        const data = await res.json();
        if (!data.status) throw new Error(data.error || 'Erreur serveur');
        const { name, dl_link, stream_link, source } = data;
        const ext = stream_link.split('.').pop().toLowerCase();
        const mediaWrapper = document.getElementById('mediaWrapper');
        let mediaHTML = '';
        if (['mp3', 'm4a', 'wav'].includes(ext)) {
          mediaHTML = `<div class="audio-container"><audio controls><source src="${stream_link}" type="audio/${ext}">Votre navigateur ne supporte pas l'audio HTML5.</audio></div>`;
        } else if (['mp4', '3gp', 'flv', 'webm'].includes(ext)) {
          mediaHTML = `<video controls><source src="${stream_link}" type="video/${ext}">Votre navigateur ne supporte pas la vidéo HTML5.</video>`;
        } else {
          mediaHTML = `<p>Format non pris en charge</p>`;
        }
        mediaWrapper.innerHTML = mediaHTML;
        document.getElementById('mediaTitle').textContent = name;
        const downloadBtn = document.getElementById('downloadBtn');
        downloadBtn.href = dl_link;
        downloadBtn.setAttribute("download", name);
        const btnReturn = document.getElementById('btnReturn');
        btnReturn.style.display = 'inline-block';
        btnReturn.onclick = () => { window.location.href = '/' + source.toLowerCase(); };
      } catch (err) {
        document.getElementById('mediaWrapper').innerHTML = '';
        document.getElementById('mediaTitle').textContent = 'Erreur : ' + err.message;
      }
    }
    const id = getIdFromPath();
    if (id) fetchResult(id);
    else document.getElementById('mediaTitle').textContent = "Identifiant manquant dans l'URL.";
  </script>
</body>
</html>
